// Prisma schema for CLOB Exchange Indexer
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  orderId      String   @id @map("order_id")
  party        String
  marketId     String   @map("market_id")
  side         String
  price        Decimal  @db.Decimal
  quantity     Decimal  @db.Decimal
  remainingQty Decimal  @map("remaining_qty") @db.Decimal
  status       String
  createdAt    DateTime @map("created_at")
  updatedAt    DateTime @default(now()) @map("updated_at")

  @@map("orders")
  @@index([party])
  @@index([marketId])
}

model Trade {
  tradeId    String   @id @map("trade_id")
  buyer      String
  seller     String
  marketId   String   @map("market_id")
  price      Decimal  @db.Decimal
  quantity   Decimal  @db.Decimal
  timestamp  DateTime
  buyOrderId String?  @map("buy_order_id")
  sellOrderId String? @map("sell_order_id")

  @@map("trades")
  @@index([marketId])
  @@index([timestamp])
}

model Balance {
  party        String
  instrumentId String   @map("instrument_id")
  amount       Decimal  @db.Decimal
  updatedAt    DateTime @default(now()) @map("updated_at")

  @@id([party, instrumentId])
  @@map("balances")
}

model OrderbookLevel {
  marketId  String
  side      String
  price     Decimal  @db.Decimal
  quantity  Decimal  @db.Decimal
  updatedAt DateTime @default(now()) @map("updated_at")

  @@id([marketId, side, price])
  @@map("orderbook_levels")
}

model LedgerCursor {
  id        Int      @id @default(1)
  offset    String   @map("offset")
  updatedAt DateTime @default(now()) @map("updated_at")

  @@map("ledger_cursor")
}
